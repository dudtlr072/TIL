# 변환연산자

변환연산자는 데이터의 흐름을 원하는 대로 변형할 수 있는 연산자로 **concatMap(), switchMap(), scan(), groupBy()** 가 있다.



## concatMap()

> - flatMap()과 비슷한 함수
> - flatMap()과는 다르게 들어온 **데이터들의 순서를 보장**해준다.

![concatMap](https://raw.github.com/wiki/ReactiveX/RxJava/images/rx-operators/concatMap.png)



## switchMap()

> - flatMap(), concatMap()과는 다르게 새로운 데이터가 들어오면 **기존에 진행중이던 작업은 중지시키고 새로 시작**한다.
> - 센서 등의 값을 얻어와서 동적으로 처리하는 경우에 유용하다.

![switchMap](https://raw.github.com/wiki/ReactiveX/RxJava/images/rx-operators/switchMap.png)



### Code 비교

```java
Utils.setStartTime();

String[] list = {"1", "3", "5"};
Observable.interval(100, TimeUnit.MILLISECONDS)
  .map(emit -> emit.intValue())
  .map(index -> list[index])
  .take(3) // flatMap(), concatMap(), switchMap()으로 각각 변경
  .concatMap(listItem -> Observable.interval(200, TimeUnit.MILLISECONDS)
             .map(emit -> listItem + "-" + emit)
             .take(2))
  .subscribe(result -> Utils.log_i("result: " + result));

Utils.sleep(5000);
```

```java
// Output
// 1. flatMap()
Thread[RxComputationThreadPool-2,5,main] | 795ms | result: 1-0
Thread[RxComputationThreadPool-3,5,main] | 894ms | result: 3-0
Thread[RxComputationThreadPool-2,5,main] | 996ms | result: 1-1
Thread[RxComputationThreadPool-4,5,main] | 998ms | result: 5-0
Thread[RxComputationThreadPool-3,5,main] | 1095ms | result: 3-1
Thread[RxComputationThreadPool-4,5,main] | 1195ms | result: 5-1
  
// 2. concatMap()
Thread[RxComputationThreadPool-2,5,main] | 609ms | result: 1-0
Thread[RxComputationThreadPool-2,5,main] | 809ms | result: 1-1
Thread[RxComputationThreadPool-3,5,main] | 1009ms | result: 3-0
Thread[RxComputationThreadPool-3,5,main] | 1209ms | result: 3-1
Thread[RxComputationThreadPool-4,5,main] | 1410ms | result: 5-0
Thread[RxComputationThreadPool-4,5,main] | 1610ms | result: 5-1

// 3. switchMap()
Thread[RxComputationThreadPool-4,5,main] | 1037ms | result: 5-0
Thread[RxComputationThreadPool-4,5,main] | 1237ms | result: 5-1
```

> concatMap()이 순서를 보장하여 데이터를 내보내는 반면, flatMap()은 아래 사진처럼 순서를 보장하지 못하고 오는 순서대로 그때그때 맞는 데이터를 내보낸다. switchMap()은 2번쨰 Observable이 시작하기전에 1번째 Observable에서 데이터가 계속 발행되기 때문에 마지막 "5"번에 해당하는 값만 출력된다.

![concatMap](concatMap.jpg)



